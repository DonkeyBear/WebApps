const keys={C:"[I]","C#":"[I#]",D:"[II]","D#":"[II#]",E:"[III]",F:"[IV]","F#":"[IV#]",G:"[V]","G#":"[V#]",A:"[VI]","A#":"[VI#]",B:"[VII]"},pitchNameFix={"#b":"","b#":"","E#":"F",Fb:"E","B#":"C",Cb:"B","C##":"D","D##":"E","F##":"G","G##":"A","A##":"B"};function transpose(){function e(e){for(let t=0;t<12;t++)e=e.replaceAll(Object.keys(keys)[t],Object.values(keys)[t]);for(let t=0;t<12;t++){let n=t+l;n>=12?n-=12:n<0&&(n+=12),e=e.replaceAll(Object.values(keys)[t],Object.keys(keys)[n])}for(let t=0;t<11;t++)e=e.replaceAll(Object.keys(pitchNameFix)[t],Object.values(pitchNameFix)[t]);return e=(e=(e=e.replaceAll("\n","<br>")).replaceAll(" ","&nbsp;")).replaceAll(/([A-G](#|b)?)(\(?(M|maj|major|m|min|minor|dim|sus|dom|aug)?(\+|-|add)?\d*\)?)(\+|-)?\d*\(?(sus\d*)?(M|maj|major)?\d*\)?(\/(([A-G]|\d*)(#|b)?))?/g,'<span class="is-chord">$&</span>')}var t=document.getElementById("chordSheet").value,n=document.getElementById("select-transpose-type").value,l=Number(document.getElementById("transpose-value").value);if(t=(t=t.replaceAll("♯","#")).replaceAll("♭","b"),0!=(l>=-11&&l<=11)){if("capo"==n&&(l=0-l),document.getElementById("check-91pu-optimize").checked){chordSheetArray=t.split("\n");for(let t=0;t<chordSheetArray.length;t++)-1!=chordSheetArray[t].indexOf("|")?chordSheetArray[t]=e(chordSheetArray[t]):chordSheetArray[t]=chordSheetArray[t].replaceAll(" ","&nbsp;");t=chordSheetArray.join("<br>")}else t=e(t);document.getElementById("check-replace-sharp-flat").checked&&(t=(t=(t=(t=t.replaceAll(/[A-G]#/g,"$&SHARP-SYMBOL")).replaceAll(/[A-G]b/g,"$&FLAT-SYMBOL")).replaceAll("#SHARP-SYMBOL",'<span class="music-symbol">♯</span>')).replaceAll("bFLAT-SYMBOL",'<span class="music-symbol">♭</span>')),document.getElementById("output").innerHTML=t}else alert("請輸入 -11 到 11 之間的值！")}function clearSheetTextArea(){document.getElementById("chordSheet").value="",document.getElementById("transpose-value").value="",document.getElementById("chordSheet").focus()}function changeFontSize(e){let t=document.getElementById("fontSize").innerHTML;0!=(t=Number(t)+e)&&(document.getElementById("fontSize").innerHTML=t,document.getElementById("output").style.cssText+="font-size: "+t+"px;")}function changeLineHeight(e){let t=document.getElementById("lineHeight").innerHTML;(t=Number(t)+e)<0||(document.getElementById("lineHeight").innerHTML=t,document.getElementById("output").style.cssText+="line-height: "+t+"px;")}function changePaddingLeft(e){let t=document.getElementById("padding").innerHTML;t<0||t>100||(t=Number(t)+e,document.getElementById("padding").innerHTML=t,document.getElementById("output").style.cssText+="padding-left: "+t+"%;")}
